@let url = kcContext.url;
@let isSetRetry = kcContext.isSetRetry;
@let isAppInitiatedAction = kcContext.isAppInitiatedAction;

<kc-login-template
  [displayInfo]="displayInfo"
  [bodyClassName]="bodyClassName()"
  [displayMessage]="displayMessage"
  [displayRequiredFields]="displayRequiredFields()"
  [documentTitle]="documentTitle()"
>
  <ng-container headerNode>
    <span [kcClass]="'kcWebAuthnKeyIcon'"></span>
    {{ 'webauthn-registration-title' | msgStr }}
  </ng-container>
  <ng-container content>
    <form
      id="register"
      [kcClass]="'kcFormClass'"
      [action]="url.loginAction"
      method="post"
    >
      <div [kcClass]="'kcFormGroupClass'">
        <input
          type="hidden"
          id="clientDataJSON"
          name="clientDataJSON"
        />
        <input
          type="hidden"
          id="attestationObject"
          name="attestationObject"
        />
        <input
          type="hidden"
          id="publicKeyCredentialId"
          name="publicKeyCredentialId"
        />
        <input
          type="hidden"
          id="authenticatorLabel"
          name="authenticatorLabel"
        />
        <input
          type="hidden"
          id="transports"
          name="transports"
        />
        <input
          type="hidden"
          id="error"
          name="error"
        />
        <kc-logout-other-sessions />
      </div>
    </form>
    <input
      type="submit"
      [kcClass]="['kcButtonClass', 'kcButtonPrimaryClass', 'kcButtonBlockClass', 'kcButtonLargeClass']"
      [id]="authButtonId"
      [value]="'doRegisterSecurityKey' | msgStr"
    />
    @if (!isSetRetry && isAppInitiatedAction) {
      <form
        [action]="url.loginAction"
        [kcClass]="'kcFormClass'"
        id="kc-webauthn-settings-form"
        method="post"
      >
        <button
          type="submit"
          [kcClass]="['kcButtonClass', 'kcButtonDefaultClass', 'kcButtonBlockClass', 'kcButtonLargeClass']"
          id="cancelWebAuthnAIA"
          name="cancel-aia"
          value="true"
        >
          {{ 'doCancel' | msgStr }}
        </button>
      </form>
    }
  </ng-container>
</kc-login-template>
